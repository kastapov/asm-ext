(window.webpackJsonp=window.webpackJsonp||[]).push([[2],{"1U8s":function(t,e,n){"use strict";n.d(e,"a",(function(){return r})),n.d(e,"b",(function(){return o}));var r="https://api.asm.ca.com/v3",o="https://asm.ca.com"},EtE5:function(t,e,n){"use strict";n.r(e);var r=n("qYNf"),o=n("vDqi"),c=n.n(o),a=n("mrSG"),u=function(){return function(t){this.access_token=t}}();function i(t,e){var n;chrome.storage.local.set(((n={})[t]=e,n))}function s(t){return new Promise((function(e,n){try{chrome.storage.local.get([t],(function(n){e(n[t])}))}catch(r){n(r)}}))}var f=n("1U8s");function h(t){var e=t.data;if(e.error)return Promise.reject(e);var n={grant_type:"authorization_code",client_id:1,client_secret:"",code:e.url.split("code=")[1],redirect_uri:"https://asm.ca.com"};return c()({url:f.a+"/oauth2/token",method:"post",data:n})}var d=n("oI8v"),O=function(){function t(t,e){this.state=t,this.payload=e}return t.OK=function(e){return new t(d.a.OK,e)},t.ERROR=function(e){return new t(d.a.ERROR,e)},t.FAIL=function(e){return new t(d.a.FAIL,e)},t}(),l=n("zLx7");function m(t){return function(e){var n;(null===(n=e.data)||void 0===n?void 0:n.error)?t(O.ERROR(e.data)):t(O.OK((null==e?void 0:e.data)||e))}}c.a.interceptors.response.use((function(t){return t}),(function(t){return 403===t.response.status&&i("token",null),Promise.reject(t)})),c.a.interceptors.request.use((function(t){return s("token").then((function(e){return t.headers.Authorization="Bearer "+e,Promise.resolve(t)}))})),chrome.runtime.onMessage.addListener((function(t,e,n){switch(t.action){case r.a.LOGIN:return(d=t.payload,function(t){var e={client_id:1,redirect_uri:"https://asm.ca.com",email:t.email,password:t.password,state:Math.floor(1e8*Math.random()),response_type:"code"};return c()({url:f.a+"/oauth2/auth",method:"post",data:e})}(d).then(h).then((function(t){return i("token",t.data.access_token),t}))).then(m(n)).catch((function(t){n(O.FAIL(t))})),!0;case r.a.CHECK_LOGIN:return function(){return Object(a.b)(this,void 0,void 0,(function(){var t;return Object(a.d)(this,(function(e){switch(e.label){case 0:return[4,s("token")];case 1:return(t=e.sent())?[2,c()({url:f.a+"/oauth2",method:"get"}).then((function(){return new u(t)}))]:[2,Promise.reject()]}}))}))}().then(m(n)).catch((function(t){n(O.FAIL(t))})),!0;case r.a.LOGOUT:return function(){return Object(a.b)(this,void 0,void 0,(function(){return Object(a.d)(this,(function(t){switch(t.label){case 0:return[4,s("token")];case 1:return t.sent()?[2,c()({url:f.a+"/oauth2/token",method:"delete"})]:[2,Promise.resolve()]}}))}))}().then(m(n)).catch((function(t){n(O.FAIL(t))})),!0;case r.a.SAVE_CONFIG:return(v=t.payload,i("config",v),Promise.resolve(v)).then(m(n)).catch((function(t){n(O.FAIL(t))})),!0;case r.a.LOAD_CONFIG:return function(){return Object(a.b)(this,void 0,void 0,(function(){var t;return Object(a.d)(this,(function(e){switch(e.label){case 0:return[4,s("config")];case 1:return(t=e.sent())?[2,t]:[2,Promise.reject()]}}))}))}().then(m(n)).catch((function(t){n(O.FAIL(t))})),!0;case r.a.UPDATE_STAT_MOCK:return(o=t.payload,o.number>0?(o.status===l.a.OK?chrome.browserAction.setBadgeBackgroundColor({color:"#4caf50"}):chrome.browserAction.setBadgeBackgroundColor({color:"#f44336"}),chrome.browserAction.setBadgeText({text:String(o.number)})):chrome.browserAction.setBadgeText({text:""}),Promise.resolve()).then(m(n)).catch((function(t){n(O.FAIL(t))})),!0}var o,d,v}))},oI8v:function(t,e,n){"use strict";n.d(e,"a",(function(){return r}));var r=function(t){return t[t.OK=0]="OK",t[t.ERROR=1]="ERROR",t[t.FAIL=2]="FAIL",t}({})},qYNf:function(t,e,n){"use strict";n.d(e,"a",(function(){return r}));var r=function(t){return t[t.LOGIN=0]="LOGIN",t[t.LOGOUT=1]="LOGOUT",t[t.CHECK_LOGIN=2]="CHECK_LOGIN",t[t.SAVE_CONFIG=3]="SAVE_CONFIG",t[t.LOAD_CONFIG=4]="LOAD_CONFIG",t[t.UPDATE_STAT_MOCK=5]="UPDATE_STAT_MOCK",t}({})},zLx7:function(t,e,n){"use strict";n.d(e,"a",(function(){return r}));var r=function(t){return t[t.OK=0]="OK",t[t.FAIL=1]="FAIL",t}({})}},[["EtE5",0,1]]]);